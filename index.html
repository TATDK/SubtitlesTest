<!DOCTYPE html>
<html>
<head>
    <title>Subtitle test</title>
    <style type="text/css">
        #player {
            position: relative;
            width: 560px;
            height: 315px;
        }
        .subtitles-overlay {
            position: absolute;
            top:250px;
            text-align: center;
            width:100%;
        }
        .subtitles-overlay-text {
            padding: 2px;
            background: rgba(0,0,0,0.8);
            color: #FFFFFF;
            display: none;
            line-height: 23px;
        }
        #timer {
            width: 100px;
            display: inline-block;
        }
    </style>
</head>

<body>
    <h1>Player with subtitles</h1>
    <div id="player">
        <div id="ytapiplayer">You need Flash player 8+ and JavaScript enabled to view this video.</div>
        <div class="subtitles-overlay"><span class="subtitles-overlay-text"></span></div>
    </div>
    <button onclick="player.playVideo()">Play</button>
    <button onclick="player.pauseVideo()">Pause</button>
    <button onclick="player.seekTo(0);player.stopVideo()">Stop</button>
    Time: <span id="timer"></span>
    Volume: <input type="range" min="0" max="100" id="volume" onchange="setVolume($(this).val());" />
    <h1>Subtitle Source</h1>
    <pre id="subtitles">
        1
        00:00:00,300 --> 00:00:02,650
        We bought to many games

        2
        00:00:02,900 --> 00:00:04,300
        Now we got to play them all

        3
        00:00:05,000 --> 00:00:08,000
        Multiline test
        with 2 lines

        4
        00:00:08,000 --> 00:00:10,000
        Multiline test
        now with
        3 lines

        5
        00:00:10,000 --> 00:00:12,000
        Multiline test
        now with
        even more
        lines
    </pre>
    <script type="text/javascript" src="http://code.jquery.com/jquery-1.10.2.min.js"></script>
    <script type="text/javascript" src="swfobject.js"></script>
    <script type="text/javascript">
        function setVolume(a) {
            if (a > 0) {
                if (player.isMuted()) player.unMute();
            } else {
                if (!player.isMuted()) player.mute();
            }
            player.setVolume(a);
        }

        function onYouTubePlayerReady(playerId) {
            player = document.getElementById("yt_player");
            player.loadVideoById('8DPGGa-K7P8');
            player.stopVideo();
            $('#volume').val(player.isMuted() ? 0 : player.getVolume());
            setInterval(function() { $('#timer').text(subtitleController.fromSeconds(player.getCurrentTime())); subtitleController.show(player.getCurrentTime()); },100);
        }

        var subtitleController = {
            init: function() {
                this.currentSubtitle = -1;
                this.subtitles = this.parse();
            },
            toSeconds: function(a) {
                var b = 0.0;
                if (a) {
                    var c = a.split(':');
                    for (d = 0;d < c.length;d++)
                        b = b * 60 + parseFloat(c[d].replace(',', '.'));
                }
                return b;
            },
            fromSeconds: function(a) {
                var b = {a:0,b:0,c:0,d:0};
                if (a) {
                    b.a = Math.floor(a/3600);
                    a -= b.a*3600;
                    b.b = Math.floor(a/60);
                    a -= b.b*60;
                    b.c = Math.floor(a);
                    a -= b.c;
                    b.d = Math.floor(a*1000);
                }
                return (b.a < 10 ? '0' : '') + b.a + ':' + (b.b < 10 ? '0' : '') + b.b + ':' + (b.c < 10 ? '0' : '') + b.c + ',' + (b.d < 100 ? '00' : b.d < 10 ? '0' : '') + b.d;
            },
            strip: function(a) {
                return a.replace(/^\s+|\s+$/g,"");
            },
            parse: function() {
                var a = $('#subtitles').text();
                a = a.replace(/\r\n|\r|\n/g, '\n')
        
                var b = [];
                a = this.strip(a);
                var c = a.split('\n\n');
                for (d in c) {
                    e = c[d].split('\n');
                    if (e.length >=2) {
                        n = e[0];
                        i = this.strip(e[1].split(' --> ')[0]);
                        o = this.strip(e[1].split(' --> ')[1]);
                        t = e[2].trim();
                        if (e.length > 2) {
                            for (f = 3;f < e.length;f++)
                                t += '<br />' + e[f];
                        }
                        is = this.toSeconds(i);
                        os = this.toSeconds(o);
                        b.push({i:is, o: os, t: t});
                    }
                }
                return b;
            },
            show: function(a) {
                var b = -1;
                for (c in this.subtitles) {
                    var d = subtitleController.subtitles[c];
                    if (d.i > a) continue;
                    if (d.i < b.i) continue;
                    b = c;
                }
                if (b >= 0) {
                    if (b != this.currentSubtitle) {
                        this.currentSubtitle = b;
                        $('.subtitles-overlay').css('top',313-(23*this.subtitles[b].t.split('<br />').length)).find('span').html(this.subtitles[b].t).css('display','inline');
                    } else if (this.subtitles[b].o < a) $('.subtitles-overlay').find('span').html('').css('display','none');
                }
            }
        }

        var player,
            test = $("#test");

        subtitleController.init();

        var params = { allowScriptAccess: "always" };
        var atts = { id: "yt_player" };
        swfobject.embedSWF("http://www.youtube.com/apiplayer?enablejsapi=1&playerapiid=ytplayer&version=3", "ytapiplayer", "560", "315", "8", null, null, params, atts);
    </script>
</body>
</html>